version: 2.1
orbs:
  cypress: cypress-io/cypress@3.1.2
workflows:
  build:
    jobs:
        - cypress/install
        - cypress/run:
            requires:
              - cypress/install
            store_artifacts: true
            parallel: true
            parallelism: 3
            group: 2 machines
            steps:
              - run:
                command: |
                  TEST="$(circleci tests glob "cypress/e2e/*Test.cy.js")" | circleci tests split
                  npm run cypress --spec ${Test}